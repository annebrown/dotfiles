"use strict";var I=Object.create;var d=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var _=Object.getOwnPropertyNames;var k=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty;var R=(e,t)=>{for(var r in t)d(e,r,{get:t[r],enumerable:!0})},x=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of _(t))!N.call(e,s)&&s!==r&&d(e,s,{get:()=>t[s],enumerable:!(n=S(t,s))||n.enumerable});return e};var i=(e,t,r)=>(r=e!=null?I(k(e)):{},x(t||!e||!e.__esModule?d(r,"default",{value:e,enumerable:!0}):r,e)),M=e=>x(d({},"__esModule",{value:!0}),e);var X={};R(X,{activate:()=>U,deactivate:()=>K});module.exports=M(X);var c=i(require("vscode"));var m=i(require("vscode")),E=i(require("child_process")),p=i(require("path"));var o=i(require("vscode")),A=i(require("child_process")),g=i(require("path")),F=i(require("fs")),b="batch-runner",C="cmdPath";function l(e){let t;return e?t=o.workspace.getWorkspaceFolder(o.Uri.file(e)):o.window.activeTextEditor&&(t=o.workspace.getWorkspaceFolder(o.window.activeTextEditor.document.uri)),o.workspace.getConfiguration(b,t)}function B(){try{return A.execFileSync("net",["session"],{stdio:"ignore"}),!0}catch{return!1}}function h(){let e=l().get(C);if(e||(e="C:\\windows\\System32\\cmd.exe"),!F.existsSync(e)){let t="Update path";o.window.showErrorMessage(`Cmd.exe could not be located at ${e}`,t).then(r=>{if(r===t){let n=`${b}.${C}`;o.commands.executeCommand("workbench.action.openSettings",n)}});return}return e}function P(e,t){return g.normalize(e).toLowerCase()===g.normalize(t).toLowerCase()}var $="Batch Runner Terminal";function j(e=!0,t=!0){let r=()=>{let n=h();return m.window.createTerminal($,n)};for(let n of m.window.terminals)if(n.name===$)return t?(n.dispose(),r()):n;if(e)return r()}function D(e,t=[]){let r=j();if(!r)return!1;let s=`cls & cd "${p.dirname(e)}" & "${e}" ${t.join(" ")}`;return r.sendText(s,!0),r.show(),!0}function O(e,t=[],r=!1){let n=h();if(!n)return!1;let s=p.dirname(e),a=`start "${e}" /d "${s}" "${n}" /c ""${e}" ${t.join(" ")}"`;return r&&(a=`powershell Start-Process "${n}" -verb runAs -ArgumentList /c, title, """${e}""", """&""", cd, /d, """${s}""", """&""", """${e}"""`,t.length>0&&(a+=`, """${t.join(" ")}"""`)),E.exec(a),!0}async function f(e,t=[],r=!1){let n=l(e),s=n.get("runBatchIn");if(n.get("saveFileBeforeRun")){let u=m.window.activeTextEditor?.document;if(u&&P(e,u.uri.fsPath)&&u.isDirty&&!await u.save())return!1}return r&&!B()||s==="External-cmd"?O(e,t,r):D(e,t)}var T=i(require("vscode")),w={};async function y(e){let t=e?G(e):"",r=await T.window.showInputBox({placeHolder:"Arguments...",prompt:"Arguments to pass to the batch file",value:t});if(r!==void 0)return r?(e&&z(e,r),[r]):[]}function z(e,t){w[e]={arg:t}}function G(e){return w[e]?w[e].arg:""}function U(e){e.subscriptions.push(c.commands.registerCommand("batch-runner.execBatchFile",t=>{let r=v(t);r&&f(r,[],!1)})),e.subscriptions.push(c.commands.registerCommand("batch-runner.execBatchFileArgs",async t=>{let r=v(t);if(r){let n=await y(r);n!==void 0&&f(r,n,!1)}})),e.subscriptions.push(c.commands.registerCommand("batch-runner.execBatchFileAdmin",t=>{let r=v(t);r&&f(r,[],!0)}))}function K(){}function v(e){if(e){let t=e.path;return t&&t.startsWith("/")&&(t=t.replace("/","")),t}return c.window.activeTextEditor?.document.uri.fsPath}0&&(module.exports={activate,deactivate});
